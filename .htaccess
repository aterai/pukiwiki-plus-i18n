# Apache .htaccess for PukiWiki
#
# $Id: .htaccess,v 1.14.2 2006/08/06 23:25:00 upk Exp $
# Copyright (C)
#   2006      PukiWiki Plus! Developers Team
#   2002-2005 PukiWiki Developers Team
#   2001      Originally written by yu-ji
# License: GPL v2 or (at your option) any later version
#
# NOTE: Correct permission of this file 644(or 604)

## Access control by Order/Allow/Deny directives
## needs 'AllowOverride Limit' at httpd.conf

# Prohibit direct access to .htaccess, .htpasswd or others
# (If it's not set by default)
# <FilesMatch "^\.ht">
# 	Order allow,deny
# 	Deny from all
# </FilesMatch>

ErrorDocument 404 /error/404.html
# SetEnv TZ JST-9

AddDefaultCharset UTF-8
AddType "text/html; charset=UTF-8" .html

AddType application/x-java-jnlp-file .jnlp
AddType application/x-java-archive-diff .jardiff
AddType application/java-archive .jar
# Addtype application/pdf .pdf

Options All -Indexes
#IndexOptions Charset=UTF-8
DirectoryIndex index.php FrontPage.html index.html

<Files robots.txt>
order deny,allow
allow from all
</Files>

# SetEnvIfNoCase User-Agent "(Baidu|Sogou)" bad_bot
#
# ## spam
# order allow,deny
# allow from all
# deny from env=bad_bot
# deny from www.style-7.com
# deny from .ovh.net
# deny from 192.69.88.0/21
# deny from 173.44.32.0/19
# deny from 173.44.37.0/28
# deny from 96.47.224.0/20
# deny from 46.161.41.34
# deny from 91.232.96.8
# deny from 95.215.0.27
# deny from 183.60.244.46
# deny from 188.143.232.
# deny from 188.143.234.
# deny from 190.7.109.158
# deny from 193.105.210.226
# deny from 195.2.240.106
# deny from 213.238.175.57
# deny from 61.135.

## naver.co.jp/naver.com
# deny from 202.234.172.0/25
# deny from 219.163.205.160/27
# deny from 218.145.25.0/24
# deny from 220.73.165.0/22
# deny from 202.179.180.0/24
# deny from 222.122.194.97

## naver?
# deny from 61.78.59.0/21
# deny from 61.247.192

## KORNET
# deny from 218.144.0.0/12
# deny from 220.72.0.0/11

## Baiduspider
# deny from 60.28.17

## spam
# deny from 59.10.239.128/25
# deny from reversedns.resolve.ru
# deny from unknown.sagonet.net
# deny from CUSTOMER.VPLS.NET
# deny from pc2m.net
# deny from 219.94.168.216
# deny from rfcrawler.com
# deny from 118.13.83.120
# deny from 67.70.32.0/67.70.35.255

# BrowserMatch "^Opera/9\.0 \(Windows NT 5\.1; U; en\)$" spam
# BrowserMatch ".*RFCrawler.*" spam
# BrowserMatch "^WWW\-Mechanize/" spam
# BrowserMatch "^$" spam
#
# <Directory /path/to/ptetex/>
# AllowOverride Limit
# </Directory>
#

# Prohibit direct access
<FilesMatch "\.(ini\.php|lng\.php)$">
	Order allow,deny
	Deny from all
</FilesMatch>

## Authentication to this directory with basic-auth
## needs 'AllowOverride AuthConfig' at httpd.conf
#AuthType Basic
#AuthName      "Authentication required"
#AuthUserFile  /path/to/.htpasswd
#AuthGroupFile /dev/null
#Require       valid-user

#AuthType Digest
#AuthName "PukiWikiAuth"
#AuthDigestProvider file
#AuthUserFile /path/to/.htdigest
#Require valid-user
#BrowserMatch "MSIE" AuthDigestEnableQueryStringHack=On

## Using zlib.output_compression per directory (via .htaccess)
## needs 'AllowOverride Options' at httpd.conf
##
## NOTE:
##   Define PKWK_ZLIB_LOADABLE_MODULE somewhere if you are using
##   PHP extension as loadable module (especially FreeBSD ports)
##   (See BugTrack/738 for detail)
#php_flag zlib.output_compression On

RewriteEngine on
RewriteBase /

# RewriteCond %{REQUEST_URI} ^/(en|PukiWiki|swing/swing[^a-z]).*$
# RewriteRule .* - [G]

# RewriteRule ^Recent\.html$ index.php?cmd=recent [L]
# RewriteRule ^List\.html$ index.php?cmd=list [L]
RewriteRule ^sitemap\.xml$ index.php?cmd=sitemaps [QSA,PT,L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.+)\.html$ index.php?cmd=read&page=$1 [QSA,PT,L]

<FilesMatch "\.(js|css|xml|gz)$">
Header append Vary: Accept-Encoding
</FilesMatch>

<FilesMatch "\.(js|css)$">
RewriteEngine on
RewriteBase /
RewriteCond %{HTTP:Accept-Encoding} gzip
RewriteCond %{REQUEST_FILENAME} !\.gz$
RewriteCond %{REQUEST_FILENAME}\.gz -f
RewriteRule ^.+$ %{REQUEST_URI}.gz
</FilesMatch>

<FilesMatch "\.(ico|jpg|jpeg|png|gif|js|css|gz)$">
FileETag none
Header set Cache-Control "max-age=2419200, public"
</FilesMatch>
